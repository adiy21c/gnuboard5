<%# views/member/register_form.ejs %>

<link rel="stylesheet" href="/member_skins/basic/style.css">
<script src="/js/jquery.register_form.js"></script> <%# GNUBoard's original JS, may need porting or replacement %>
<% if (locals.config_cf_cert_use && (locals.config_cf_cert_simple || locals.config_cf_cert_ipin || locals.config_cf_cert_hp)) { %>
    <script src="/js/certify.js"></script> <%# GNUBoard's original JS, may need porting or replacement %>
<% } %>

<div class="register">
    <form id="fregisterform" name="fregisterform" action="/auth/register-form" onsubmit="return fregisterform_submit(this);" method="post" enctype="multipart/form-data" autocomplete="off">
        <input type="hidden" name="w" value="<%= locals.w || '' %>">
        <input type="hidden" name="url" value="<%= locals.urlencode || '' %>">
        <input type="hidden" name="agree" value="1"> <%# Assuming terms already agreed %>
        <input type="hidden" name="agree2" value="1"> <%# Assuming terms already agreed %>

        <% if (locals.error && error.length > 0) { %>
            <div class="alert alert-danger" style="color: red; margin-bottom: 10px; padding: 10px; border: 1px solid red;">
                 <% error.forEach(function(err) { %>
                    <p><%= err %></p>
                <% }); %>
            </div>
        <% } %>

        <div id="register_form" class="form_01">
            <div class="register_form_inner">
                <h2>사이트 이용정보 입력</h2>
                <ul>
                    <li>
                        <label for="reg_mb_id">아이디 (필수)</label>
                        <input type="text" name="mb_id" value="<%= formData.mb_id || '' %>" id="reg_mb_id" required class="frm_input full_input required" minlength="3" maxlength="20" placeholder="아이디">
                        <button type="button" id="btn_mb_id_check" class="btn_frmline">중복확인</button>
                        <span id="msg_mb_id"></span>
                    </li>
                    <li class="half_input left_input margin_input">
                        <label for="reg_mb_password">비밀번호 (필수)</label>
                        <input type="password" name="mb_password" id="reg_mb_password" required class="frm_input full_input required" minlength="3" maxlength="20" placeholder="비밀번호">
                    </li>
                    <li class="half_input left_input">
                        <label for="reg_mb_password_re">비밀번호 확인 (필수)</label>
                        <input type="password" name="mb_password_re" id="reg_mb_password_re" required class="frm_input full_input required" minlength="3" maxlength="20" placeholder="비밀번호 확인">
                    </li>
                </ul>
            </div>

            <div class="tbl_frm01 tbl_wrap register_form_inner">
                <h2>개인정보 입력</h2>
                <ul>
                    <li>
                        <label for="reg_mb_name">이름 (필수)</label>
                        <input type="text" id="reg_mb_name" name="mb_name" value="<%= formData.mb_name || '' %>" required class="frm_input full_input required" placeholder="이름">
                    </li>
                    <li>
                        <label for="reg_mb_nick">닉네임 (필수)</label>
                        <input type="text" name="mb_nick" value="<%= formData.mb_nick || '' %>" id="reg_mb_nick" required class="frm_input required nospace full_input" placeholder="닉네임">
                        <button type="button" id="btn_mb_nick_check" class="btn_frmline">중복확인</button>
                        <span id="msg_mb_nick"></span>
                    </li>
                    <li>
                        <label for="reg_mb_email">E-mail (필수)</label>
                        <input type="email" name="mb_email" value="<%= formData.mb_email || '' %>" id="reg_mb_email" required class="frm_input email full_input required" placeholder="E-mail">
                        <button type="button" id="btn_mb_email_check" class="btn_frmline">중복확인</button>
                        <span id="msg_mb_email"></span>
                    </li>
                    <li>
                        <label for="reg_mb_homepage">홈페이지</label>
                        <input type="url" name="mb_homepage" value="<%= formData.mb_homepage || '' %>" id="reg_mb_homepage" class="frm_input full_input" placeholder="홈페이지">
                    </li>
                    <li>
                        <label for="reg_mb_tel">전화번호</label>
                        <input type="text" name="mb_tel" value="<%= formData.mb_tel || '' %>" id="reg_mb_tel" class="frm_input full_input" placeholder="전화번호">
                    </li>
                    <li>
                        <label for="reg_mb_hp">휴대폰번호</label>
                        <input type="text" name="mb_hp" value="<%= formData.mb_hp || '' %>" id="reg_mb_hp" class="frm_input full_input" placeholder="휴대폰번호">
                    </li>
                    <li>
                        <label>주소</label>
                        <input type="text" name="mb_zip" value="<%= formData.mb_zip || '' %>" id="reg_mb_zip" class="frm_input twopart_input" placeholder="우편번호">
                        <button type="button" class="btn_frmline" onclick="win_zip('fregisterform', 'mb_zip', 'mb_addr1', 'mb_addr2', 'mb_addr3', 'mb_addr_jibeon');">주소 검색</button><br>
                        <input type="text" name="mb_addr1" value="<%= formData.mb_addr1 || '' %>" id="reg_mb_addr1" class="frm_input frm_address full_input" placeholder="기본주소"><br>
                        <input type="text" name="mb_addr2" value="<%= formData.mb_addr2 || '' %>" id="reg_mb_addr2" class="frm_input frm_address full_input" placeholder="상세주소"><br>
                        <input type="text" name="mb_addr3" value="<%= formData.mb_addr3 || '' %>" id="reg_mb_addr3" class="frm_input frm_address full_input" readonly="readonly" placeholder="참고항목">
                        <input type="hidden" name="mb_addr_jibeon" value="<%= formData.mb_addr_jibeon || '' %>">
                    </li>
                </ul>
            </div>

            <div class="tbl_frm01 tbl_wrap register_form_inner">
                <h2>기타 개인설정</h2>
                <ul>
                    <li>
                        <label for="reg_mb_signature">서명</label>
                        <textarea name="mb_signature" id="reg_mb_signature" class="full_input" placeholder="서명"><%= formData.mb_signature || '' %></textarea>
                    </li>
                    <li>
                        <label for="reg_mb_profile">자기소개</label>
                        <textarea name="mb_profile" id="reg_mb_profile" class="full_input" placeholder="자기소개"><%= formData.mb_profile || '' %></textarea>
                    </li>
                    <li class="chk_box">
                        <input type="checkbox" name="mb_mailling" value="1" id="reg_mb_mailling" <%= (formData.mb_mailling || locals.w === '') ? 'checked' : '' %> class="selec_chk">
                        <label for="reg_mb_mailling"><span></span> 정보 메일을 받겠습니다.</label>
                    </li>
                    <li class="chk_box">
                        <input type="checkbox" name="mb_sms" value="1" id="reg_mb_sms" <%= (formData.mb_sms || locals.w === '') ? 'checked' : '' %> class="selec_chk">
                        <label for="reg_mb_sms"><span></span> 휴대폰 문자메세지를 받겠습니다.</label>
                    </li>
                    <li class="chk_box">
                        <input type="checkbox" name="mb_open" value="1" id="reg_mb_open" <%= (formData.mb_open || locals.w === '') ? 'checked' : '' %> class="selec_chk">
                        <label for="reg_mb_open"><span></span> 다른분들이 나의 정보를 볼 수 있도록 합니다.</label>
                    </li>
                    <li>
                        <label for="reg_mb_recommend">추천인아이디</label>
                        <input type="text" name="mb_recommend" id="reg_mb_recommend" class="frm_input" placeholder="추천인아이디" value="<%= formData.mb_recommend || '' %>">
                    </li>
                    <li class="is_captcha_use">
                        자동등록방지 <%# captcha_html(); - Captcha needs server-side integration %>
                        <p>캡차는 추후 구현 예정입니다.</p>
                    </li>
                </ul>
            </div>
        </div>
        <div class="btn_confirm">
            <a href="/" class="btn_close">취소</a>
            <button type="submit" id="btn_submit" class="btn_submit">회원가입</button>
        </div>
    </form>
</div>

<script>
// Basic AJAX check function (example)
function ajax_check(url, data, message_id) {
    $.ajax({
        url: url,
        type: "POST",
        data: data,
        dataType: "json",
        success: function(response) {
            $("#" + message_id).text(response.message).css("color", response.available ? "green" : "red");
        },
        error: function() {
            $("#" + message_id).text("오류가 발생했습니다.").css("color", "red");
        }
    });
}

$(function() {
    // ID Check
    $("#btn_mb_id_check").click(function() {
        ajax_check("/auth/check-userid", { mb_id: $("#reg_mb_id").val() }, "msg_mb_id");
    });
    // Nickname Check
    $("#btn_mb_nick_check").click(function() {
        ajax_check("/auth/check-nickname", { mb_nick: $("#reg_mb_nick").val() }, "msg_mb_nick");
    });
    // Email Check
    $("#btn_mb_email_check").click(function() {
        ajax_check("/auth/check-email", { mb_email: $("#reg_mb_email").val() }, "msg_mb_email");
    });

    // Other client-side validations from original jquery.register_form.js would go here
    // For now, a simple submit handler
});
function fregisterform_submit(f) {
    if (f.mb_password.value !== f.mb_password_re.value) {
        alert("비밀번호가 일치하지 않습니다.");
        f.mb_password_re.focus();
        return false;
    }
    // Add other client-side validations as needed
    $("#btn_submit").prop("disabled", true);
    return true;
}
// Placeholder for Daum Postcode API
function win_zip(frm_name, frm_zip, frm_addr1, frm_addr2, frm_addr3, frm_jibeon) {
    alert("주소 검색 기능은 실제 API 연동이 필요합니다.");
    // Example: new daum.Postcode({ oncomplete: function(data) { ... } }).open();
}
</script>
<style>
/* Basic styles from register_form.skin.php for demonstration */
.register { max-width: 700px; margin: 20px auto; padding: 20px; border: 1px solid #ddd; background: #fff; }
.register_form_inner { margin-bottom:20px; padding-bottom:15px; border-bottom:1px solid #eee; }
.register_form_inner:last-child { border-bottom:none; }
.register_form_inner h2 { font-size: 1.3em; margin-bottom: 15px; }
.register_form_inner ul { list-style: none; padding: 0; margin: 0; }
.register_form_inner li { margin-bottom: 12px; }
.register_form_inner label { display: block; margin-bottom: 5px; font-weight: bold; }
.frm_input { width: 100%; padding: 8px; border: 1px solid #ccc; box-sizing: border-box; border-radius: 3px; }
.full_input { /* width:100%; */ }
.half_input { width: calc(50% - 5px); display: inline-block; }
.half_input.margin_input { margin-right: 10px; }
.twopart_input { width: calc(100% - 110px); margin-right:5px; display:inline-block; vertical-align:middle; }
.btn_frmline { padding: 8px 12px; border: 1px solid #ccc; background: #f0f0f0; cursor: pointer; vertical-align:middle; }
.frm_address { margin-top:5px; }
textarea.full_input { height: 80px; }
.chk_box label { font-weight: normal; }
.chk_box input.selec_chk { margin-right: 5px; }
.btn_confirm { text-align: center; margin-top: 20px; }
.btn_confirm .btn_close, .btn_confirm .btn_submit { padding: 12px 25px; text-decoration: none; border-radius: 3px; margin: 0 5px; font-size:1.1em; }
.btn_confirm .btn_close { background-color: #6c757d; color: white; border: none; }
.btn_confirm .btn_submit { background-color: #007bff; color: white; border: none; cursor: pointer; }
#msg_mb_id, #msg_mb_nick, #msg_mb_email { font-size:0.9em; margin-left:5px; }
</style>
<%# Daum Postcode API script would be included in layout.ejs or here if needed %>
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
