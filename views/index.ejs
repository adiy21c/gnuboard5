<%# views/index.ejs %>
<h2 class="sound_only">최신글</h2>

<%# Popup Layer - Handled in layout.ejs or via a global partial if active_popups exist %>
<% if (locals.active_popups && active_popups.length > 0) { %>
    <div id="new_win_popup_area">
    <% active_popups.forEach(function(popup, i) { %>
        <div id="hd_pops_<%= popup.nw_id %>" class="hd_pops" style="top:<%= popup.nw_top %>px;left:<%= popup.nw_left %>px;width:<%= popup.nw_width %>px;height:<%= popup.nw_height %>px;">
            <div class="hd_pops_con" style="width:<%= popup.nw_width %>px;height:<%= popup.nw_height %>px;">
                <% if (popup.nw_content_html === 2 || popup.nw_content_html === 1) { // 2:HTML, 1:Text %>
                    <%- popup.nw_content %>
                <% } else { // 0: Editor %>
                    <%- popup.nw_content %> <%# Assuming editor content is safe HTML %>
                <% } %>
            </div>
            <div class="hd_pops_footer">
                <button class="hd_pops_reject hd_pops_<%= popup.nw_id %>" data-hours="<%= popup.nw_disable_hours %>" data-id="<%= popup.nw_id %>"><strong><%= popup.nw_disable_hours %></strong>시간 동안 열지않음</button>
                <button class="hd_pops_close hd_pops_<%= popup.nw_id %>" data-id="<%= popup.nw_id %>">닫기</button>
            </div>
        </div>
    <% }); %>
    </div>
    <script>
    $(function() {
        $(".hd_pops_reject").click(function() {
            var id = $(this).data("id");
            var hours = $(this).data("hours");
            var ck_name = "hd_pops_"+id;
            set_cookie(ck_name, "1", hours, g5_cookie_domain);
            $("#hd_pops_"+id).hide();
        });
        $(".hd_pops_close").click(function() {
            var id = $(this).data("id");
            $("#hd_pops_"+id).hide();
        });
    });
    </script>
    <style>
    #new_win_popup_area .hd_pops { position:absolute; border:1px solid #e9e9e9; background:#fff; z-index:1000; }
    #new_win_popup_area .hd_pops_con { padding:10px; }
    #new_win_popup_area .hd_pops_footer { padding:0; background:#000; color:#fff; text-align:left; }
    #new_win_popup_area .hd_pops_footer button { padding:5px 10px; border:0; background:#000; color:#fff; cursor:pointer; }
    </style>
<% } %>


<div class="latest_top_wr">
    <%# echo latest('pic_list', 'free', 4, 23); %>
    <%- include('partials/latest/pic_list', { items: latest_free, title: '자유게시판 최신글', bo_table: 'free', skin: 'pic_list' }) %>

    <%# echo latest('pic_list', 'qa', 4, 23); %>
    <%# Assuming latest_qa is fetched in controller %>
    <% if (locals.latest_qa && latest_qa.length > 0) { %>
        <%- include('partials/latest/pic_list', { items: latest_qa, title: '질문답변 최신글', bo_table: 'qa', skin: 'pic_list' }) %>
    <% } else { %>
        <%- include('partials/latest/pic_list', { items: [], title: '질문답변 최신글', bo_table: 'qa', skin: 'pic_list' }) %>
    <% } %>


    <%# echo latest('pic_list', 'notice', 4, 23); %>
    <%- include('partials/latest/pic_list', { items: latest_notice_data, title: '공지사항 최신글', bo_table: 'notice', skin: 'pic_list' }) %>
</div>

<div class="latest_wr">
    <%# echo latest('pic_block', 'gallery', 4, 23); %>
    <%- include('partials/latest/pic_block', { items: latest_gallery, title: '갤러리 최신글', bo_table: 'gallery', skin: 'pic_block' }) %>
</div>

<%# Loop for other boards - this data (other_boards_latest) would need to be fetched in the controller %>
<% if (locals.other_boards_latest && other_boards_latest.length > 0) { %>
    <div class="latest_wr">
        <% other_boards_latest.forEach((board_data, i) => { %>
            <% const lt_style = (i % 3 !== 0) ? "margin-left:2%" : ""; %>
            <div style="float:left; <%= lt_style %>" class="lt_wr">
                <%- include('partials/latest/basic', { items: board_data.items, title: board_data.title, bo_table: board_data.bo_table, skin: 'basic' }) %>
            </div>
        <% }); %>
        <div style="clear:both;"></div>
    </div>
<% } %>


<%# Placeholder for Shop Content - if data is available %>
<% if (locals.shop_hit_items && shop_hit_items.length > 0) { %>
    <div class="shop-main-section">
        <h2>히트 상품</h2>
        <div class="item-list">
            <% shop_hit_items.forEach(item => { %>
                <div class="shop-item">
                    <a href="/shop/item.php?it_id=<%= item.it_id %>">
                        <% if (item.it_img1) { %> <%# Assuming it_img1 is the path %>
                            <img src="<%= item.it_img1 %>" alt="<%= item.it_name %>" style="width:150px; height:auto;">
                        <% } else { %>
                            <span class="no-image">[상품 이미지 없음]</span>
                        <% } %>
                        <p><%= item.it_name %></p>
                        <p><strong><%= new Intl.NumberFormat().format(item.it_price) %> 원</strong></p>
                    </a>
                </div>
            <% }); %>
        </div>
    </div>
<% } %>

<style>
.latest_top_wr { display: flex; justify-content: space-between; margin-bottom: 20px; }
.latest_top_wr > div { width: calc(33.333% - 14px); /* Adjust margin */ }
.latest_wr { margin-bottom: 20px; }
.lt_wr { width: calc(32% - 0px); /* Adjust for margin-left */ margin-bottom: 20px; } /* Clearfix needed if float is kept */
.lt_wr:nth-child(3n+1) { margin-left: 0 !important; }
@media (max-width: 992px) {
    .latest_top_wr > div { width: calc(50% - 10px); margin-bottom:15px; }
    .lt_wr { width: calc(50% - 10px); }
}
@media (max-width: 768px) {
    .latest_top_wr { flex-direction: column; }
    .latest_top_wr > div { width: 100%; margin-bottom:15px; }
    .lt_wr { width: 100%; margin-left:0 !important; }
}

/* Basic shop item styling */
.shop-main-section h2 { text-align: center; margin-bottom: 20px; }
.shop-main-section .item-list { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; }
.shop-main-section .shop-item { border: 1px solid #eee; padding: 10px; text-align: center; width: 200px; }
.shop-main-section .shop-item img { max-width: 100%; height: auto; margin-bottom: 10px; }
.shop-main-section .shop-item .no-image { display: block; width: 150px; height: 150px; line-height:150px; background-color: #f0f0f0; margin:0 auto 10px auto; }
</style>
